---
title: "script"
author: "LAR"
date: "6/11/2021"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# libraries
```{r}
library(tidyverse)
library(readxl)
```

# data 
All files need to be saved as .xlsx, and year column added 

## sunflower
```{r}
#2012-2013
sf_2013_1 <- read_xlsx("data/sunflower/sf_part_1_2012_2013.xls.xlsx")
sf_2013_2 <- read_xlsx("data/sunflower/sf_part_2_2012_2013.xls.xlsx")
sf_2013_3 <- read_xlsx("data/sunflower/sf_part_3_2012_2013.xls.xlsx")
sf_2013_4 <- read_xlsx("data/sunflower/sf_part_4_2012_2013.xls.xlsx")

#2013-2014
sf_2014_1 <- read_xlsx("data/sunflower/sf_part_1_2013_2014.xls.xlsx")
sf_2014_2 <- read_xlsx("data/sunflower/sf_part_2_2013_2014.xls.xlsx")
sf_2014_3 <- read_xlsx("data/sunflower/sf_part_3_2013_2014.xls.xlsx")
sf_2014_4 <- read_xlsx("data/sunflower/sf_part_4_2013_2014.xls.xlsx")

#2014-2015
sf_2015_1 <- read_xlsx("data/sunflower/sf_part_1_2014_2015.xls.xlsx")
sf_2015_2 <- read_xlsx("data/sunflower/sf_part_2_2014_2015.xls.xlsx")
sf_2015_3 <- read_xlsx("data/sunflower/sf_part_3_2014_2015.xls.xlsx")
sf_2015_4 <- read_xlsx("data/sunflower/sf_part_4_2014_2015.xls.xlsx")

#2015-2016
sf_2016_1 <- read_xlsx("data/sunflower/sf_part_1_2015_2016.xls.xlsx")
sf_2016_2 <- read_xlsx("data/sunflower/sf_part_2_2015_2016.xls.xlsx")
sf_2016_3 <- read_xlsx("data/sunflower/sf_part_3_2015_2016.xls.xlsx")


#2016-2017
sf_2017_1 <- read_xlsx("data/sunflower/sf_part_1_2016_2017.xls.xlsx")
sf_2017_2 <- read_xlsx("data/sunflower/sf_part_2_2016_2017.xls.xlsx")
sf_2017_3 <- read_xlsx("data/sunflower/sf_part_3_2016_2017.xls.xlsx")
sf_2017_4 <- read_xlsx("data/sunflower/sf_part_4_2016_2017.xls.xlsx")

#2017-2018
sf_2018_1 <- read_xlsx("data/sunflower/sf_part_1_2017_2018.xls.xlsx")
sf_2018_2 <- read_xlsx("data/sunflower/sf_part_2_2017_2018.xls.xlsx")
sf_2018_3 <- read_xlsx("data/sunflower/sf_part_3_2017_2018.xls.xlsx")
sf_2018_4 <- read_xlsx("data/sunflower/sf_part_4_2017_2018.xls.xlsx")

#2018-2019
sf_2019_1 <- read_xlsx("data/sunflower/sf_part_1_2018_2019.xls.xlsx")
sf_2019_2 <- read_xlsx("data/sunflower/sf_part_2_2018_2019.xls.xlsx")
sf_2019_3 <- read_xlsx("data/sunflower/sf_part_3_2018_2019.xls.xlsx")
sf_2019_4 <- read_xlsx("data/sunflower/sf_part_4_2018_2019.xls.xlsx")
#2019-2020
sf_2020_1 <- read_xlsx("data/sunflower/sf_part_1_2019_2020.xls.xlsx")
sf_2020_2 <- read_xlsx("data/sunflower/sf_part_2_2019_2020.xls.xlsx")
sf_2020_3 <- read_xlsx("data/sunflower/sf_part_3_2019_2020.xls.xlsx")
sf_2020_4 <- read_xlsx("data/sunflower/sf_part_4_2019_2020.xls.xlsx")
```

## join
```{r}
#2013
sf_201213_df <- sf_2013_1 %>% 
  full_join(sf_2013_2) %>% 
  full_join(sf_2013_3) %>% 
  full_join(sf_2013_4) %>% 
  mutate(harvest_year = 2013) %>% 
  rename(desc = Region) %>% 
  filter(desc %in% c("3. Sclerotia, %", "No. of samples")) %>% 
  distinct() %>%
 pivot_longer(cols = c(2:23),
               names_to = "region",
               values_to = "per_sclerotia") %>% 
  pivot_wider(names_from = "desc",
              values_from = "per_sclerotia") %>% 
  rename(per_scl = "3. Sclerotia, %",
         no_samples = "No. of samples")

#2014 
sf_201314_df <- sf_2014_1 %>% 
  full_join(sf_2014_2) %>% 
  full_join(sf_2014_3) %>% 
  full_join(sf_2014_4) %>% 
  mutate(harvest_year = 2014) %>% 
  rename(desc = Region) %>% 
    filter(desc %in% c("3. Sclerotia, %", "No. of samples")) %>% 
  distinct() %>%
 pivot_longer(cols = c(2:22),
               names_to = "region",
               values_to = "per_sclerotia") %>% 
  pivot_wider(names_from = "desc",
              values_from = "per_sclerotia") %>% 
  rename(per_scl = "3. Sclerotia, %",
         no_samples = "No. of samples")

#2015
sf_201415_df <- sf_2015_1 %>% 
  full_join(sf_2015_2) %>% 
  full_join(sf_2015_3) %>% 
  full_join(sf_2015_4) %>% 
  mutate(harvest_year = 2015) %>% 
  rename(desc = Region) %>% 
    filter(desc %in% c("3. Sclerotia, %", "No. of samples")) %>% 
  distinct() %>%
 pivot_longer(cols = c(2:24),
               names_to = "region",
               values_to = "per_sclerotia") %>% 
  pivot_wider(names_from = "desc",
              values_from = "per_sclerotia") %>% 
  rename(per_scl = "3. Sclerotia, %",
         no_samples = "No. of samples")

#2016
sf_201516_df <- sf_2016_1 %>% 
  full_join(sf_2016_2) %>% 
  full_join(sf_2016_3) %>% 
  mutate(harvest_year = 2016) %>% 
  rename(desc = Region) %>% 
    filter(desc %in% c("3. Sclerotia, %", "No. of samples")) %>% 
  distinct() %>%
 pivot_longer(cols = c(2:19),
               names_to = "region",
               values_to = "per_sclerotia") %>% 
  pivot_wider(names_from = "desc",
              values_from = "per_sclerotia") %>% 
  rename(per_scl = "3. Sclerotia, %",
         no_samples = "No. of samples")

#2017
sf_201617_df <- sf_2017_1 %>% 
  full_join(sf_2017_2) %>% 
  full_join(sf_2017_3) %>% 
  full_join(sf_2017_4) %>% 
  mutate(harvest_year = 2017) %>% 
  rename(desc = Region) %>% 
    filter(desc %in% c("3. Sclerotia, %", "No. of samples")) %>% 
  distinct() %>%
 pivot_longer(cols = c(2:20),
               names_to = "region",
               values_to = "per_sclerotia") %>% 
  pivot_wider(names_from = "desc",
              values_from = "per_sclerotia") %>% 
  rename(per_scl = "3. Sclerotia, %",
         no_samples = "No. of samples")

#2018
sf_201718_df <- sf_2018_1 %>% 
  full_join(sf_2018_2) %>% 
  full_join(sf_2018_3) %>% 
  full_join(sf_2018_4) %>% 
  mutate(harvest_year = 2018) %>% 
  rename(desc = Region) %>% 
    filter(desc %in% c("3. Sclerotia, %", "No. of samples")) %>% 
  distinct() %>%
 pivot_longer(cols = c(2:20),
               names_to = "region",
               values_to = "per_sclerotia") %>% 
  pivot_wider(names_from = "desc",
              values_from = "per_sclerotia") %>% 
  rename(per_scl = "3. Sclerotia, %",
         no_samples = "No. of samples")

#2019
sf_201819_df <-sf_2019_1 %>% 
  full_join(sf_2019_2) %>% 
  full_join(sf_2019_3) %>% 
  full_join(sf_2019_4) %>% 
  mutate(harvest_year = 2019) %>% 
  rename(desc = Region) %>% 
    filter(desc %in% c("3. Sclerotia, %", "No. of samples")) %>% 
  distinct() %>%
 pivot_longer(cols = c(2:22),
               names_to = "region",
               values_to = "per_sclerotia") %>% 
  pivot_wider(names_from = "desc",
              values_from = "per_sclerotia") %>% 
  rename(per_scl = "3. Sclerotia, %",
         no_samples = "No. of samples")

#2020
sf_201920_df <- sf_2020_1 %>% 
  full_join(sf_2020_2) %>% 
  full_join(sf_2020_3) %>% 
  full_join(sf_2020_4) %>% 
  mutate(harvest_year = 2020) %>% 
  rename(desc = Region) %>% 
    filter(desc %in% c("3. Sclerotia, %", "No. of samples")) %>% 
  distinct() %>%
 pivot_longer(cols = c(2:21),
               names_to = "region",
               values_to = "per_sclerotia") %>% 
  pivot_wider(names_from = "desc",
              values_from = "per_sclerotia") %>% 
  rename(per_scl = "3. Sclerotia, %",
         no_samples = "No. of samples")

sf_201213_df %>% 
  full_join(sf_201314_df) %>% 
  full_join(sf_201415_df) %>% 
  full_join(sf_201516_df) %>% 
  full_join(sf_201617_df) %>% 
  full_join(sf_201718_df) %>% 
  full_join(sf_201819_df) %>% 
  full_join(sf_201920_df) %>% 
  mutate(over_th = case_when(per_scl == 0 ~ "No sclerotia detected",
                             per_scl > 0 & per_scl < 0.2 ~ "Under all thresholds",
                             per_scl >= 0.2 & per_scl < 4 ~ "Above SANSOR threshold (0.2%)",
                             per_scl >=4 ~ "Above DAFF threshold (4%)"))
```

## silo regions
s
```{r}
silo_regions <- read.csv("data/silo_regions.csv") %>% select(-X)
```

